# This workflow will build the client api files using the swager codegen url and push the output into its own folder. Then copy both server and client api files into the master. Finally pushing the master package to npm

name: TD Ameritrade API Workflow CI
on:
  push:
    # Use `swaggerhub` branch to create nodejs client and publish to npm
    branches: [ swaggerhub ]
env:
  #This is only needed for act emulation ???
  ACTIONS_RUNTIME_TOKEN: sadfjdksalfjdsalfjdasklfjask
  #ACTIONS_RUNTIME_URL: https://0.0.0.0/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/
  ACTIONS_RUNTIME_URL: localhost

jobs:
  codegen:
    name: Swagger Code Gen
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: curl
        id: curl
        uses: gitchrisqueen/curl-action-output@master
        with:
          curl: |
            -X POST https://generator3.swagger.io/api/generate -H "content-type:application/json" -d '{"specURL":"https://raw.githubusercontent.com/gitchrisqueen/tdameritrade-api/swaggerhub/nodejs-server/api/openapi.yaml","lang":"javascript","type":"CLIENT","codegenVersion":"V3","options":{"additionalProperties":{"sortParamsByRequiredFlag":true,"projectName":"js-client","usePromises":"true","modelPropertyNaming":"PascalCase"}}}'
      #- run: mv ./swagger.zip ./swagger-gen/swagger.zip
      - name: unzip
        needs: steps.curl
        uses: gitchrisqueen/action-zip@master
        with:
          args: unzip ${{ steps.curl.outputs.response }} ./js-client